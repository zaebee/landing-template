{% from "components/contact-form/modules/_contact_form_modules.html" import form_title, form_field, form_button, form_status_message with context %}

<section
  data-sads-component="contact-form"
  id="contact" {# Keep ID for potential navigation #}
  data-sads-padding="xl"
  data-sads-bg-color="contact-section-bg"
  data-sads-text-align="center"
>
  <div
    data-sads-element="container" {# This is the form wrapper div #}
    data-sads-max-width="custom:600px"
    data-sads-margin="custom:0 auto"
    data-sads-bg-color="contact-form-inner-bg" {# Theme: surface / surface-accent-dark #}
    data-sads-padding="xl" {# Theme: 2rem #}
    data-sads-border-radius="xl" {# Theme: 8px #}
    data-sads-shadow="medium" {# Theme: medium shadow #}
  >
    {{ form_title(text_key='title', default_text='Contact Us') }}

    <form
      data-sads-element="form"
      class="contact-form-tag" {# Added class for CSS targeting if needed for submit hover #}
      id="contactForm" {# ID is used by the script #}
      method="POST"
      action="{{ config.form_action_uri if config and config.form_action_uri else '#' }}"
      data-form-action-url="{{ config.form_action_uri if config and config.form_action_uri else '#' }}"
      data-success-message="{{ translations.get(config.success_message_key, 'Message sent!') if config else 'Message sent!' }}"
      data-error-message="{{ translations.get(config.error_message_key, 'Error sending message.') if config else 'Error sending message.' }}"
      data-sads-display="flex"
      data-sads-flex-direction="column"
      data-sads-gap="m"
    >
      {{ form_field(id='name', name='name', label_text_key='name', label_default_text='Name:', required=True) }}
      {{ form_field(id='email', name='email', label_text_key='email', label_default_text='Email:', input_type='email', required=True) }}
      {{ form_field(id='message', name='message', label_text_key='message', label_default_text='Message:', input_type='textarea', required=True, rows=4) }}

      {{ form_button(text_key='send', default_text='Send Message', css_class='contact-submit-button') }}
      {{ form_status_message(id='contactFormStatus') }}
    </form>
  </div>
</section>

{# The script part remains the same as it's client-side JavaScript #}
{# It's already designed to pick up data attributes from the form tag and target IDs #}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("contactForm");
    if (form) {
      const statusDiv = document.getElementById("contactFormStatus");
      const actionUrl = form.dataset.formActionUrl;
      const successMessage = form.dataset.successMessage;
      const errorMessage = form.dataset.errorMessage;

      form.addEventListener("submit", function (event) {
        event.preventDefault();
        const formData = new FormData(form);
        statusDiv.textContent = "";
        statusDiv.classList.remove("success", "error"); // Keep class-based styling for status messages for now

        fetch(actionUrl, {
          method: "POST",
          body: formData,
          headers: {
            Accept: "application/json",
          },
        })
          .then((response) => {
            if (response.ok) {
              statusDiv.textContent = successMessage;
              statusDiv.classList.add("success"); // JS adds 'success' class
              form.reset();
            } else {
              response.json().then((data) => {
                if (Object.hasOwn(data, "errors")) {
                  statusDiv.textContent = data["errors"]
                    .map((error) => error["message"])
                    .join(", ");
                } else {
                  statusDiv.textContent = errorMessage;
                }
                statusDiv.classList.add("error"); // JS adds 'error' class
              });
            }
          })
          .catch((error) => {
            statusDiv.textContent = errorMessage;
            statusDiv.classList.add("error");
          });
      });
    }
  });
</script>

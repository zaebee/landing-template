# Data Flow and Protobuf Definitions

This document outlines the structure of our data entities defined using Protocol Buffers and how they are utilized within the `build.py` script to generate dynamic HTML content.

## Protobuf Message Definitions

We use Protocol Buffers to define the schema for our dynamic data entities.

### `BlogPost`

Represents a single blog post item.

```proto
syntax = "proto3";

package project;

option go_package = "example.com/project/proto";

message BlogPost {
  string id = 1;                 // Unique identifier for the blog post
  string title_i18n_key = 2;     // Key for localized title string
  string excerpt_i18n_key = 3;   // Key for localized excerpt string
  string cta_i18n_key = 4;       // Key for localized call-to-action text
  string link = 5;               // URL link for the blog post
}
```

### `PortfolioItem`

Represents a single portfolio item.

```proto
syntax = "proto3";

package project;

option go_package = "example.com/project/proto";

message PortfolioItem {
  string id = 1;                 // Unique identifier for the portfolio item
  string img_src = 2;            // Source URL for the item's image
  string img_alt = 3;            // Alt text for the item's image
  string title_i18n_key = 4;     // Key for localized title string
  string desc_i18n_key = 5;      // Key for localized description string
}
```

## Data Flow in `build.py`

The `build.py` script is responsible for generating the static HTML pages (`index.html`, `index_es.html`, etc.) by assembling HTML blocks and populating them with dynamic data and translations.

```mermaid
graph TD
    A[JSON Data Files: data/*.json] --> B{build.py Script};
    C[Proto Definitions: proto/*.proto] --> D[protoc];
    D --> E[Generated Python Stubs: generated/*.py];
    E --> B;
    F[HTML Block Templates: blocks/*.html] --> B;
    G[Locale Translations: locales/*.json] --> B;
    B --> H[Output HTML Files: index_lang.html];

    subgraph "Data Loading and Processing"
        B_LOAD[load_dynamic_data()]
        B_GEN_BLOG[generate_blog_html()]
        B_GEN_PORT[generate_portfolio_html()]
        B_TRANSLATE[translate_html_content()]
    end

    A -- Reads --> B_LOAD;
    E -- Used by --> B_LOAD;
    B_LOAD -- Protobuf Objects --> B_GEN_BLOG;
    B_LOAD -- Protobuf Objects --> B_GEN_PORT;
    B_GEN_BLOG -- HTML Snippets --> B;
    B_GEN_PORT -- HTML Snippets --> B;
    F -- Assembled by --> B;
    G -- Used for I18N by --> B_TRANSLATE;
    B_TRANSLATE -- Translated HTML --> B;

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style C fill:#f9f,stroke:#333,stroke-width:2px
    style F fill:#f9f,stroke:#333,stroke-width:2px
    style G fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#ccf,stroke:#333,stroke-width:2px
    style H fill:#cfc,stroke:#333,stroke-width:2px
    style B fill:#9cf,stroke:#333,stroke-width:4px
```

### Explanation of Diagram:

1.  **JSON Data Files (`data/*.json`)**: These files (e.g., `blog_posts.json`, `portfolio_items.json`) contain the raw data for blog posts and portfolio items.
2.  **Proto Definitions (`proto/*.proto`)**: These files define the structure of `BlogPost` and `PortfolioItem` messages.
3.  **protoc (Protocol Buffer Compiler)**: This tool compiles the `.proto` definitions into Python stubs.
4.  **Generated Python Stubs (`generated/*.py`)**: These are the Python classes (`BlogPost_pb2.py`, `PortfolioItem_pb2.py`) generated by `protoc`. They are imported and used by `build.py`.
5.  **`build.py` Script**:
    *   **`load_dynamic_data(file_path, message_type)`**: Reads a JSON data file, and uses `json_format.ParseDict` from the `google.protobuf` library to parse each JSON object into an instance of the specified protobuf message type (e.g., `BlogPost` or `PortfolioItem`).
    *   **`generate_blog_html(posts, translations)`**: Takes a list of `BlogPost` protobuf objects and generates the corresponding HTML structure for the blog section. It accesses fields like `post.title_i18n_key`, `post.link`, etc.
    *   **`generate_portfolio_html(items, translations)`**: Takes a list of `PortfolioItem` protobuf objects and generates the HTML for the portfolio section. It accesses fields like `item.img_src`, `item.title_i18n_key`, etc.
    *   The script then assembles these generated HTML snippets with other static blocks from `blocks/*.html`.
    *   **`translate_html_content(html_content, translations)`**: Applies translations from `locales/*.json` to elements tagged with `data-i18n`.
6.  **HTML Block Templates (`blocks/*.html`)**: These are partial HTML files that are combined to form the final pages. Placeholders like `{{blog_posts}}` and `{{portfolio_items}}` are replaced with dynamically generated content.
7.  **Locale Translations (`locales/*.json`)**: JSON files containing key-value pairs for internationalization.
8.  **Output HTML Files (`index_lang.html`)**: The final, fully assembled and translated HTML pages (e.g., `index.html`, `index_es.html`).

This setup ensures that data handling is strongly typed and structured, improving maintainability and reducing potential errors from manually handling dictionary keys.Tool output for `create_file_with_block`:
